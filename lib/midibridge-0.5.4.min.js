(function(){function f(){return!b.ready?(g&&g("midibridge not ready!"),"midibridge not ready!"):!0}function u(){try{d=b.getObject("midibridge-applet")}catch(a){setTimeout(u,25)}}try{console.log("")}catch(y){console={log:function(){}}}var b={NOTE_OFF:128,NOTE_ON:144,POLY_PRESSURE:160,CONTROL_CHANGE:176,PROGRAM_CHANGE:192,CHANNEL_PRESSURE:208,PITCH_BEND:224,SYSTEM_EXCLUSIVE:240,MIDI_TIMECODE:241,SONG_POSITION:242,SONG_SELECT:243,TUNE_REQUEST:246,EOX:247,TIMING_CLOCK:248,START:250,CONTINUE:251,STOP:252,
ACTIVE_SENSING:254,SYSTEM_RESET:255,NOTE_NAMES_SHARP:"sharp",NOTE_NAMES_FLAT:"flat",NOTE_NAMES_SOUNDFONT:"soundfont",NOTE_NAMES_ENHARMONIC_SHARP:"enh-sharp",NOTE_NAMES_ENHARMONIC_FLAT:"enh-flat"},c=[];c[128]="NOTE OFF";c[144]="NOTE ON";c[160]="POLY PRESSURE";c[176]="CONTROL CHANGE";c[192]="PROGRAM CHANGE";c[208]="CHANNEL PRESSURE";c[224]="PITCH BEND";c[240]="SYSTEM EXCLUSIVE";c[241]="MIDI TIMECODE";c[242]="SONG POSITION";c[243]="SONG SELECT";c[244]="RESERVED";c[245]="RESERVED";c[246]="TUNE REQUEST";
c[247]="EOX";c[248]="TIMING CLOCK";c[249]="RESERVED";c[250]="START";c[251]="CONTINUE";c[252]="STOP";c[254]="ACTIVE SENSING";c[255]="SYSTEM RESET";var l={sharp:"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(","),flat:"C,D&#9837;,D,E&#9837;,E,F,G&#9837;,G,A&#9837;,A,B&#9837;,B".split(","),soundfont:"C,Db,D,Eb,E,F,Gb,G,Ab,A,Bb,B".split(","),"enh-sharp":"B#,C#,C##,D#,D##,E#,F#,F##,G#,G##,A#,A##".split(","),"enh-flat":"D&#9837;&#9837;,D&#9837;,E&#9837;&#9837;,E&#9837;,F&#9837;,G&#9837;&#9837;,G&#9837;,A&#9837;&#9837;,A&#9837;,B&#9837;&#9837;,B&#9837;,C&#9837;".split(",")},
e=JSON.parse,m=null,g=null,q=null,d=null,n=!1,o=!1,p=!1,i=!0,v={},r=!1,j={},s=[];b.version="0.5.4";b.ready=!1;b.noteNameModus=b.NOTE_NAMES_SHARP;var w="midiapplet-"+b.version+".jar";b.init=function(a){for(var k in c){var h=parseInt(k);switch(h){case b.NOTE_OFF:case b.NOTE_ON:case b.POLY_PRESSURE:case b.CONTROL_CHANGE:case b.PROGRAM_CHANGE:case b.CHANNEL_PRESSURE:case b.PITCH_BEND:s.push(h);for(var d=0;16>d;d++)c[h+d]=c[k];break;default:s.push(h)}}if("function"===typeof a)m=a;else if("object"===typeof a){r=
a.debug;k=a.midiCommands||s;j={};for(var f=0;f<k.length;f++)switch(h=k[f],h){case b.NOTE_OFF:case b.NOTE_ON:case b.POLY_PRESSURE:case b.CONTROL_CHANGE:case b.PROGRAM_CHANGE:case b.CHANNEL_PRESSURE:case b.PITCH_BEND:for(d=0;16>d;d++)j[h+d]=1;break;default:j[h]=1}n=void 0===a.connectAllInputs?n:a.connectAllInputs;o=void 0===a.connectFirstInput?o:a.connectFirstInput;p=void 0===a.connectFirstOutput?p:a.connectFirstOutput;i=void 0===a.connectAllInputsToFirstOutput?i:a.connectAllInputsToFirstOutput;m=a.data;
q=a.ready;g=a.error;r&&console.log(o,p,n,i,e,j)}if(navigator.javaEnabled())try{if(void 0===e)console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+");else{var t=document.createElement("div");t.setAttribute("id","midibridge-java");a="";-1===navigator.userAgent.toLowerCase().indexOf("chrome")?(a=a+'<object tabindex="0" id="midibridge-applet" type="application/x-java-applet" height="1" width="1"><param name="codebase" value="java/" />'+('<param name="archive" value="'+
w+'" />'),a+='<param name="code" value="net.abumarkub.midi.applet.MidiApplet" /><param name="scriptable" value="true" /><param name="minJavaVersion" value="1.5" />Your browser needs the Java plugin to use the midibridge. You can download it <a href="http://www.java.com/en/" target="blank" title="abumarkub midibridge download java" rel="abumarkub midibridge download java">here</a></object>'):(a+='<applet id="midibridge-applet" code="net.abumarkub.midi.applet.MidiApplet.class" archive="'+w+'" codebase="java" width="1" height="1">',
a+='<param name="minJavaVersion" value="1.5"></applet>');t.innerHTML=a;document.body.appendChild(t)}}catch(l){g?g("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+"):console.log("supported browsers: Firefox 3.5+, Chrome 4.0+, Safari 4.0+, Opera 10.5+, Internet Explorer 8.0+")}else g?g("no java plugin found; install or enable the java plugin"):console.log("no java plugin found; install or enable the java plugin")};b.msgFromJava=function(a){a=e(a);switch(a.msgId){case "upgrade-java":g?
g("please upgrade your java plugin!"):console.log("please upgrade your java plugin!");break;case "midi-started":u();d&&(v=a.devices,b.ready=!0,(p||i)&&b.connectFirstOutput(),n||i?b.connectAllInputs():o&&b.connectFirstInput(),q&&q("midibridge started"));break;case "midi-data":if(m){if(void 0===j[a.status]){r&&console.log("MIDI message intercepted",a.status,a.data1,a.data2,a.channel);break}m(new x(a))}break;case "error":g&&g(a.code)}};b.sendMidiEvent=function(a,b,c,g){return f()?e(d.processMidiEvent(a,
b,c,g)):!1};b.getDevices=function(){return v};b.refreshDevices=function(){return f()?e(d.getDevices()):!1};b.connectAllInputs=function(){return f()?e(d.connectAllInputs()):!1};b.connectFirstInput=function(){return f()?e(d.connectFirstInput()):!1};b.connectFirstOutput=function(){return f()?e(d.connectFirstOutput()):!1};b.connectAllInputsToFirstOutput=function(){return f()?e(d.connectAllInputsToFirstOutput()):!1};b.addConnection=function(a,b,c){return f()?(c=void 0===c?[]:c,e(d.addConnection(a,void 0===
b?-1:b,c))):!1};b.removeConnection=function(a,b){return f()?e(d.removeConnection(a,b)):!1};b.disconnectAll=function(){return f()?e(d.disconnectAll()):!1};b.loadBase64String=function(a){return e(d.loadBase64String(a.replace(/data:audio\/mid[i]?;base64,/,"")))};b.playBase64String=function(a){return e(d.playBase64String(a))};b.loadMidiFile=function(a){return e(d.loadMidiFile(a))};b.playMidiFile=function(a){return e(d.playMidiFile(a))};b.startSequencer=function(){d.startSequencer()};b.pauseSequencer=
function(){d.pauseSequencer()};b.stopSequencer=function(){d.stopSequencer()};b.closeSequencer=function(){d.closeSequencer()};b.getSequencerPosition=function(){return d.getSequencerPosition()};b.setSequencerPosition=function(a){d.setSequencerPosition(a)};var x=function(){var a=function(a){this.command=a.command;this.channel=a.channel;this.data1=a.data1;this.data2=a.data2;this.status=a.status;this.noteName=b.getNoteName(this.data1,b.noteNameModus);this.statusCode=b.getStatus(this.status);this.microsecond=
a.microsecond;this.time=b.getNiceTime(this.microsecond);this.command==b.NOTE_ON&&0==this.data2&&(this.command=b.NOTE_OFF,this.status=this.command+this.channel)};a.prototype={toString:function(){var a;a=""+(this.noteName+" "+this.statusCode+" "+this.data1+" "+this.data2+" "+this.channel+" "+this.status);return a+=this.microsecond?this.microsecond+" "+this.time:""},toJSONString:function(){return this.microsecond?"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+
this.data2+", 'microsecond':"+this.microsecond+", 'time':"+this.time+"}":"{'notename':"+this.noteName+", 'status':"+this.status+", 'data1':"+this.data1+", 'data2':"+this.data2+"}"}};return a}();b.MidiMessage=x;b.getNoteName=function(a,b){return l[b][a%12]+""+Math.floor(a/12-1)};b.getNoteNumber=function(a,b){var c=-1,a=a.toUpperCase(),d;for(d in l)for(var e=l[d],f=0,g=e.length;f<g;f++)if(e[f]===a){c=f;break}return-1===c?"invalid note name":12+c+12*b};b.getStatus=function(a){return c[a]};b.getNiceTime=
function(a){var b=a/1E3/1E3>>0,c=b/3600>>0,d=b%3600/60>>0,b=b%60,a=a/1E3-36E5*c-6E4*d-1E3*b+0.5>>0;return""+(0<c?c+":":"")+(0<c?10>d?"0"+d:d:d)+":"+(10>b?"0"+b:b)+":"+(0===a?"000":10>a?"00"+a:100>a?"0"+a:a)};b.getObject=function(a){var b=navigator.userAgent.toLowerCase();return-1!==b.indexOf("msie")||-1!==b.indexOf("webkit")?window[a]:document[a]};window.addEventListener||(window.addEventListener=function(a,b){window.attachEvent("onload",b)});window.midiBridge=b})(window);